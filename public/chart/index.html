<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>下注与盈亏分析</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
      .chart-container {
        width: 100%;
        max-width: 1000px;
        margin: 40px auto;
      }
      .chart-title {
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 6px;
      }
      .tab-group {
        text-align: center;
        margin-bottom: 12px;
      }
      .tab-btn {
        display: inline-block;
        padding: 6px 14px;
        margin: 0 4px;
        cursor: pointer;
        background-color: #eee;
        border-radius: 4px;
      }
      .tab-btn.active {
        background-color: #409eff;
        color: white;
      }
      #bet-chart,
      #profit-chart {
        width: 100%;
        height: 500px;
      }
    </style>
  </head>
  <body>
    <div class="chart-container">
      <div class="chart-title">下注量分析</div>
      <div class="tab-group" id="bet-tabs">
        <span class="tab-btn active" data-type="today">今天</span>
        <span class="tab-btn" data-type="week">近7天</span>
        <span class="tab-btn" data-type="month">近30天</span>
      </div>
      <div id="bet-chart"></div>
    </div>

    <div class="chart-container">
      <div class="chart-title">盈亏总数据分析</div>
      <div class="tab-group" id="profit-tabs">
        <span class="tab-btn active" data-type="today">今天</span>
        <span class="tab-btn" data-type="week">近7天</span>
        <span class="tab-btn" data-type="month">近30天</span>
      </div>
      <div id="profit-chart"></div>
    </div>

    <div class="chart-container">
      <div class="chart-title">充提差变化图</div>
      <div class="tab-group" id="charge-tabs">
        <span class="tab-btn active" data-type="week">近7天</span>
        <span class="tab-btn" data-type="month">近30天</span>
      </div>
      <div id="charge-chart" style="width: 100%; height: 400px"></div>
    </div>

    <div class="chart-container">
      <div class="chart-title">投注会员变化图</div>
      <div class="tab-group" id="member-tabs">
        <span class="tab-btn active" data-type="week">近7天</span>
        <span class="tab-btn" data-type="month">近30天</span>
      </div>
      <div id="member-chart" style="width: 100%; height: 400px"></div>
    </div>

    <script>
      const betChart = echarts.init(document.getElementById("bet-chart"));
      const profitChart = echarts.init(document.getElementById("profit-chart"));
      const chargeChart = echarts.init(document.getElementById("charge-chart"));
      const memberChart = echarts.init(document.getElementById("member-chart"));

      function renderBetChart(type) {
        $.getJSON("js/data.json", function (data) {
          const betData = data[type].bet;
          const isMobile = window.innerWidth < 768;
          betChart.setOption({
            tooltip: { trigger: "item" },
            legend: {
              orient: isMobile ? "horizontal" : "vertical",
              top: isMobile ? "bottom" : "middle",
              left: isMobile ? "center" : "80%",
              itemGap: 10,
            },
            series: [
              {
                type: "pie",
                radius: "60%",
                center: isMobile ? ["50%", "45%"] : ["40%", "50%"],
                data: betData,
                label: {
                  formatter: "{b}: {c}K ({d}%)",
                },
              },
            ],
          });
        });
      }

      function renderProfitChart(type) {
        $.getJSON("js/data.json", function (data) {
          const profitData = data[type].profit;
          profitChart.setOption({
            tooltip: {
              trigger: "axis",
              axisPointer: { type: "shadow" },
            },
            xAxis: {
              type: "category",
              data: profitData.map((i) => i.name),
              axisLabel: {
                rotate: 0,
                fontStyle: "normal",
              },
            },
            yAxis: { type: "value" },
            series: [
              {
                type: "bar",
                data: profitData.map((i) => i.value),
                itemStyle: {
                  color: function (params) {
                    return params.value >= 0 ? "#67C23A" : "#F56C6C";
                  },
                },
                label: {
                  show: true,
                  position: "top",
                  formatter: (val) => `${val.value}K`,
                },
              },
            ],
          });
        });
      }

      function renderChargeChart(type) {
        $.getJSON("js/summary-data.json", function (data) {
          const d = data.chargeWithdraw[type];
          chargeChart.setOption({
            tooltip: { trigger: "axis" },
            legend: { data: ["充值款", "提现款", "充提差"] },
            xAxis: { type: "category", data: d.date },
            yAxis: { type: "value" },
            series: [
              {
                name: "充值款",
                type: "line",
                data: d.recharge,
                smooth: true,
                itemStyle: { color: "#5470C6" },
              },
              {
                name: "提现款",
                type: "line",
                data: d.withdraw,
                smooth: true,
                itemStyle: { color: "#91CC75" },
              },
              {
                name: "充提差",
                type: "line",
                data: d.difference,
                smooth: true,
                itemStyle: { color: "red" },
                label: { show: true, formatter: (val) => `${val.value}K` },
              },
            ],
          });
        });
      }

      function renderMemberChart(type) {
        $.getJSON("js/summary-data.json", function (data) {
          const d = data.memberGrowth[type];
          memberChart.setOption({
            tooltip: { trigger: "axis" },
            xAxis: {
              type: "category",
              data: d.date,
              axisLabel: { fontStyle: "normal" },
            },
            yAxis: { type: "value" },
            series: [
              {
                name: "投注会员数",
                type: "line",
                data: d.members,
                itemStyle: { color: "#3B82F6" },
                label: { show: true, position: "top" },
              },
            ],
          });
        });
      }

      // 独立绑定下注按钮
      $("#bet-tabs .tab-btn").on("click", function () {
        $("#bet-tabs .tab-btn").removeClass("active");
        $(this).addClass("active");
        const type = $(this).data("type");
        renderBetChart(type);
      });

      // 独立绑定盈亏按钮
      $("#profit-tabs .tab-btn").on("click", function () {
        $("#profit-tabs .tab-btn").removeClass("active");
        $(this).addClass("active");
        const type = $(this).data("type");
        renderProfitChart(type);
      });

      $("#charge-tabs .tab-btn").on("click", function () {
        $("#charge-tabs .tab-btn").removeClass("active");
        $(this).addClass("active");
        renderChargeChart($(this).data("type"));
      });

      $("#member-tabs .tab-btn").on("click", function () {
        $("#member-tabs .tab-btn").removeClass("active");
        $(this).addClass("active");
        renderMemberChart($(this).data("type"));
      });

      // 初始化
      renderBetChart("today");
      renderProfitChart("today");
      renderChargeChart("week");
      renderMemberChart("week");

      window.addEventListener("resize", function () {
        betChart.resize();
        profitChart.resize();
        chargeChart.resize();
        memberChart.resize();
      });
    </script>
  </body>
</html>
